---
# Run the deploy_vmare playbook against the control host

- hosts: deploy
  gather_facts: false
  vars_files:
    - vmware_deploy/vars/vault

  vars_prompt:
    - name: "vsphere_user"
      prompt: "VSphere user"
      private: no
    - name: "vsphere_password"
      prompt: "vSphere Password"
      private: yes
    - name: "esxi_host"
      prompt: "ESXi host"
      private: no
      default: atlantis.plumbus.lab
    - name: "notes"
      prompt: "VM notes"
      private: no
      default: "Deployed with ansible"
  roles:
     - vmware_deploy

- hosts: deploy
  gather_facts: false
  remote_user: "{{ provisioned_user_name }}"
  become: true
  vars_files:
    - management_user/vars/vault
  vars:
    ansible_become_pass: "{{ provisioned_user_pass }}"
    ansible_ssh_pass: "{{ provisioned_user_pass }}"
  roles:
    - role: management_user

- hosts: deploy
  become: true
  roles:
    - role: standard_user